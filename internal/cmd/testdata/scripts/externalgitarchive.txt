exec tar czf www/archive.tar.gz archive

httpd www

# test that chezmoi reads external git-archives from .chezmoiexternal.yaml
chezmoi apply --force
cmp $HOME/.dir/file golden/file
! exists $HOME/.dir/ignore

chhome home2/user

# test that chezmoi apply reads another git-external
chezmoi apply --force

chhome home3/user

# test that chezmoi apply reads another git-external
chezmoi apply --force

-- archive/.gitignore --
ignore
-- archive/dir/file --
# contents of file
-- archive/dir/ignore --
# contents of ignore
-- golden/file --
# contents of file
-- home/user/.local/share/chezmoi/.chezmoiexternal.yaml --
.dir:
    type: git-archive
    url: "{{ env "HTTPD_URL" }}/archive.tar.gz"
    stripComponents: 2
-- home2/user/.local/share/chezmoi/.chezmoiexternal.yaml --
".oh-my-zsh":
  type: git-archive
  url: "https://github.com/ohmyzsh/ohmyzsh/archive/5b987e59d0fce1a74bcfd51750c6f52d7c29c647.tar.gz"
  stripComponents: 1
-- home3/user/.local/share/chezmoi/.chezmoiexternal.yaml --
".oh-my-zsh":
  type: git-archive
  url: "https://github.com/ohmyzsh/ohmyzsh/archive/5b987e59d0fce1a74bcfd51750c6f52d7c29c647.zip"
  stripComponents: 1
-- www/.keep --
